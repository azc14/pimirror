Version 4
SHEET 1 880 740
WIRE -400 112 -432 112
WIRE -368 112 -400 112
WIRE -240 112 -240 64
WIRE -240 112 -288 112
WIRE -160 112 -240 112
WIRE -64 112 -80 112
WIRE 32 112 -64 112
WIRE 112 112 32 112
WIRE 336 112 192 112
WIRE 432 112 336 112
WIRE 496 112 432 112
WIRE 608 112 576 112
WIRE 704 112 608 112
WIRE -496 160 -496 112
WIRE -400 160 -400 112
WIRE -64 160 -64 112
WIRE 32 160 32 112
WIRE 336 160 336 112
WIRE 432 160 432 112
WIRE 608 160 608 112
WIRE -496 272 -496 240
WIRE -400 272 -400 224
WIRE -400 272 -496 272
WIRE -496 288 -496 272
WIRE -64 304 -64 224
WIRE 32 304 32 224
WIRE 336 304 336 224
WIRE 432 304 432 240
WIRE 608 304 608 224
FLAG -496 288 0
FLAG 432 304 0
FLAG 608 304 0
FLAG 704 112 PZ_Out
IOPIN 704 112 Out
FLAG -240 64 PWM_In
IOPIN -240 64 In
FLAG 336 304 0
FLAG -64 304 0
FLAG 32 304 0
SYMBOL voltage -496 144 R0
WINDOW 3 24 96 Invisible 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 0 -85 54 Left 2
SYMATTR Value PULSE(0 190 0 0.00006 0.00010 {Ton} {Tperiod} {N})
SYMATTR InstName V1
SYMBOL res 416 144 R0
WINDOW 0 45 36 Left 2
WINDOW 3 45 76 Left 2
SYMATTR InstName R1
SYMATTR Value 10k
SYMBOL res 592 96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 1m
SYMBOL diode -496 128 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 100 37 VBottom 2
SYMATTR InstName D1
SYMATTR Value MURS320
SYMBOL polcap 592 160 R0
WINDOW 3 46 60 Left 2
WINDOW 0 35 6 Left 2
SYMATTR Value 0.3µ
SYMATTR InstName C1
SYMATTR Description Capacitor
SYMATTR Type cap
SYMATTR SpiceLine V=200 Irms=0 Rser=0.15 Lser=0
SYMBOL res -272 96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 45 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 160R
SYMBOL cap -416 160 R0
WINDOW 0 -26 9 Left 2
WINDOW 3 29 62 Left 2
SYMATTR InstName C2
SYMATTR Value 2.2pf
SYMATTR SpiceLine V=300 Rser=0.001
SYMBOL polcap 320 160 R0
WINDOW 3 42 55 Left 2
SYMATTR Value 4.7µ
SYMATTR InstName C3
SYMATTR Description Capacitor
SYMATTR Type cap
SYMATTR SpiceLine V=200 Irms=0 Rser=6.6 Lser=0
SYMBOL ind 208 96 R90
WINDOW 0 5 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName L1
SYMATTR Value 0.1
SYMATTR SpiceLine Rser=242
SYMBOL res -64 96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 43 56 VTop 2
SYMATTR InstName R4
SYMATTR Value {R1}
SYMBOL cap -80 160 R0
SYMATTR InstName C4
SYMATTR Value {C}
SYMATTR SpiceLine V=310 Rser=0.02 Lser=0
SYMBOL cap 16 160 R0
SYMATTR InstName C5
SYMATTR Value {C}
SYMATTR SpiceLine V=310 Rser=0.02 Lser=0
TEXT -504 328 Left 2 !.tran 0 6 0 0.0000005
TEXT -504 360 Left 2 !.save V(pz_out)\n*.step param C 1u 100u 1u\n.step param Ton 0.00002325 0.000465 0.00002325\n*.param Ton 0.0002\n.param C 4.7u\n.param R1 12k\n.param Tperiod 0.000625\n.param N 4800\n.MEAS Voltage_AVG AVG V(pz_out) TRIG AT=2 TARG AT=N*Tperiod\n.MEAS Timeto99 WHEN V(pz_out) = 0.99*Voltage_AVG \n.MEAS TimetoAVG WHEN V(pz_out) = Voltage_AVG \n.MEAS Vpkpk PP V(pz_out) TRIG AT=TimetoAVG TARG AT=N*Tperiod\n.MEAS temp_T_Discharge WHEN V(pz_out)=0.01*Voltage_AVG TD=N*Tperiod\n.MEAS T_Discharge WHEN time= temp_T_Discharge-N*Tperiod
